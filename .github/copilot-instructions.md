# Copilot instructions for AM Engenharia

## Big picture architecture
- Single-page React + Vite app; `App` owns auth/session state and routes users into admin vs client flows. See [src/App.jsx](src/App.jsx).
- Auth is UI-only: client login fetches company by CNPJ, admin login is simulated (password `admin123` or empty) in [src/components/auth/LoginPage.jsx](src/components/auth/LoginPage.jsx).
- All persistence goes through Supabase helpers in [src/utils/storage.js](src/utils/storage.js) and client setup in [src/utils/supabase.js](src/utils/supabase.js). Tables used include `companies`, `client_intakes`, `auto_generated_data`, and registry tables for professionals.
- The regulatory logic lives in the SST engine and auto-generation modules: risk analysis in [src/utils/sst-engine.js](src/utils/sst-engine.js) and data synthesis in [src/utils/AutomaticEngine.js](src/utils/AutomaticEngine.js).

## Data flow & document generation
- Company lookup via BrasilAPI (`fetchCompanyData`) and risk/eligibility checks (`analyzeRegulatoryStatus`) in [src/utils/sst-engine.js](src/utils/sst-engine.js).
- Intake and generated data are merged into a single `fullData` payload in `getFullClientData()` for dashboards and reviews. See [src/utils/storage.js](src/utils/storage.js).
- PDF output uses `exportToPDF()` (html2pdf) from [src/utils/pdfExport.js](src/utils/pdfExport.js). Templates are large, inline-styled React components in [src/components/documents](src/components/documents) and [src/components/Templates](src/components/Templates).
- Client-side PDF generation relies on hidden DOM render + fixed element ids (`dir-document-template`, `pgr-document-template`, `pcmso-document-template`) in [src/components/ClientDashboard.jsx](src/components/ClientDashboard.jsx). Preserve these ids when editing templates.

## Project conventions
- Heavy use of inline styles instead of CSS modules; follow existing style objects in components like [src/components/ClientDashboard.jsx](src/components/ClientDashboard.jsx) and the document templates.
- Workflow status drives UI steps (`draft`, `intake_completed`, `analysis_in_progress`, `pending_review`, `approved`) and is updated in storage helpers. See `updateAutoGenerated()` and `saveClientIntake()` in [src/utils/storage.js](src/utils/storage.js).
- Supabase calls return `{ success, data, error }` patterns; prefer `handleSupabaseError()` for consistency. See [src/utils/supabase.js](src/utils/supabase.js).
- SQL files in repo root (e.g., [fix_supabase_schema.sql](fix_supabase_schema.sql)) document schema fixes and migrations; keep them in sync with storage helpers.

## Developer workflows
- Dev server: `npm run dev` (Vite). Build: `npm run build`. Lint: `npm run lint`. Preview: `npm run preview` (see [package.json](package.json)).
- Requires `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` in the environment; the app throws on missing values in [src/utils/supabase.js](src/utils/supabase.js).

## When adding features
- Wire new data fields through the Supabase helpers first, then into UI flows; `App` and `ReviewView` orchestrate most admin/client interactions. See [src/App.jsx](src/App.jsx) and [src/components/ReviewView.jsx](src/components/ReviewView.jsx).
- For new document sections, add to the relevant template and ensure the hidden render block in [src/components/ClientDashboard.jsx](src/components/ClientDashboard.jsx) still mounts the correct template.